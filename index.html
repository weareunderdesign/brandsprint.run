<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>brandsprint.run - Craft Your Brand Story in Minutes</title>
    <link rel="icon" type="image/png" href="favicon.png?v=1">
    <link rel="apple-touch-icon" href="favicon.png">
    <link rel="shortcut icon" href="favicon.png" type="image/png">
    <meta property="og:image" content="cover.png">
    <meta property="og:title" content="brandsprint.run - Build Your Brand Personality in Minutes">
    <meta property="og:description" content="Define your brand's personality, tone of voice, and visual identity with our interactive brand builder. Get AI-powered insights and export your complete brand guide.">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content="cover.png">
    <meta name="twitter:title" content="brandsprint.run - Build Your Brand Personality in Minutes">
    <meta name="twitter:description" content="Define your brand's personality, tone of voice, and visual identity with our interactive brand builder. Get AI-powered insights and export your complete brand guide.">
    <meta name="description" content="Define your brand's personality, tone of voice, and visual identity with our interactive brand builder. Get AI-powered insights and export your complete brand guide.">
    <link rel="stylesheet" href="https://unpkg.com/@rnbws/renecss/dist/rene.min.css" />
    <style>
        #trend::placeholder, #geography::placeholder, #differentiation::placeholder, #customer::placeholder { color: rgba(255,255,255,0.7); }
        #category::placeholder, #needState::placeholder { color: rgba(0,0,0,0.7); }
    </style>
</head>
<body>
    <script>
        // ========== PERSONALITY.JS ==========
        const Personality = {
            axes: [
                { left: 'elite', right: 'mass appeal', leftBrand: 'chanel.png', rightBrand: 'hm.png' },
                { left: 'serious', right: 'playful', leftBrand: 'palantir.png', rightBrand: 'google.png' },
                { left: 'conventional', right: 'rebel', leftBrand: 'honda.png', rightBrand: 'tesla.png' },
                { left: 'friend', right: 'authority', leftBrand: 'waltdisney.png', rightBrand: 'nyt.png' },
                { left: 'mature & classic', right: 'young & innovative', leftBrand: 'booking.png', rightBrand: 'airbnb.png' }
            ],

            intensityLevels: ['hyper', 'very', 'quite', 'somewhat', 'slightly', '', 'slightly', 'somewhat', 'quite', 'very', 'hyper'],

            traitSuggestions: {
                elite: { tone: 'âœ¨ sophisticated, exclusive', look: 'ðŸŽ¯ minimalist, luxurious' },
                'mass appeal': { tone: 'ðŸ¤— relatable, accessible', look: 'ðŸŒˆ bright, simple' },
                serious: { tone: 'ðŸŽ¯ professional, formal', look: 'ðŸ”˜ muted colors, clean lines' },
                playful: { tone: 'ðŸŽ­ fun, casual', look: 'ðŸŽ¨ vibrant colors, dynamic elements' },
                conventional: { tone: 'ðŸ›ï¸ traditional, reliable', look: 'ðŸ“‹ traditional layout, familiar icons' },
                rebel: { tone: 'âš¡ innovative, bold', look: 'ðŸŽ¯ unconventional layout, bold typography' },
                friend: { tone: 'ðŸ˜Š friendly, approachable', look: 'ðŸŸ¡ rounded shapes, warm colors' },
                authority: { tone: 'ðŸ‘” authoritative, expert', look: 'ðŸ“Š structured layout, professional imagery' },
                mature: { tone: 'ðŸº timeless, refined', look: 'ðŸ“œ serif fonts, classic color palette' },
                classic: { tone: 'ðŸº timeless, refined', look: 'ðŸ“œ serif fonts, classic color palette' },
                young: { tone: 'âš¡ fresh, cutting-edge', look: 'ðŸŽ¨ modern fonts, gradient colors' },
                innovative: { tone: 'âš¡ fresh, cutting-edge', look: 'ðŸŽ¨ modern fonts, gradient colors' }
            },

            conflictRules: [
                { axes: [0, 1], threshold: 60, message: "Balancing 'elite' with 'playful' may be challenging." },
                { axes: [2, 3], threshold: 60, message: "Being both 'rebel' and 'authority' might create tension." },
                { condition: (values) => values[0] < 30 && values[4] > 70, message: "Combining 'elite' with 'young & innovative' could be tricky." },
                { condition: (values) => values[1] > 70 && values[3] > 70, message: "Being very 'playful' while maintaining strong 'authority' may be difficult." }
            ],

            calculateTraits: (sliderValues) => {
                return sliderValues.map((value, index) => {
                    const axis = Personality.axes[index];
                    const levelIndex = Math.round(value / 10);
                    
                    if (levelIndex === 5) return '';
                    
                    const intensity = Personality.intensityLevels[levelIndex < 5 ? levelIndex : 10 - levelIndex];
                    const trait = levelIndex < 5 ? axis.left : axis.right;
                    
                    return intensity ? `${intensity} ${trait}` : trait;
                }).filter(Boolean);
            },

            generateSuggestions: (traits) => {
                const toneElements = [];
                const lookElements = [];

                traits.forEach(trait => {
                    const baseTrait = trait.split(' ').pop();
                    const suggestion = Personality.traitSuggestions[baseTrait];
                    if (suggestion) {
                        toneElements.push(suggestion.tone);
                        lookElements.push(suggestion.look);
                    }
                });

                return {
                    toneOfVoice: toneElements.join(', ') || 'neutral and adaptable',
                    lookAndFeel: lookElements.join(', ') || 'clean and versatile design'
                };
            },

            detectConflicts: (sliderValues) => {
                const conflicts = [];

                Personality.conflictRules.forEach(rule => {
                    if (rule.condition) {
                        if (rule.condition(sliderValues)) {
                            conflicts.push(rule.message);
                        }
                    } else if (rule.axes && rule.threshold) {
                        const [axis1, axis2] = rule.axes;
                        if (Math.abs(sliderValues[axis1] - sliderValues[axis2]) > rule.threshold) {
                            conflicts.push(rule.message);
                        }
                    }
                });

                return conflicts.length ? conflicts : ['none detected'];
            },

            createSlider: (axis, index, app) => {
                const container = Utils.create('div', { className: 'column gap-s' });

                const sliderRow = Utils.create('div', { 
                    className: 'row gap-m align-center',
                    style: { width: '100%' }
                });

                const leftContainer = Utils.create('div', { 
                    className: 'align-center text-s',
                    style: { 
                        height: '30px', 
                        minWidth: '120px'
                    } 
                });
                const sliderContainer = Utils.create('div', { 
                    className: 'column gap-xs box',
                    style: { flex: '1' }
                });

                const labels = Utils.create('div', { 
                    className: 'row justify-stretch'
                });
                labels.appendChild(Utils.create('h5', { textContent: axis.left }));
                labels.appendChild(Utils.create('h5', { textContent: axis.right }));
                sliderContainer.appendChild(labels);

                const sliderTrack = Utils.create('div', {
                    className: 'transition',
                    style: {
                        position: 'relative',
                        borderTop: '1px dashed #ccc',
                        width: '100%'
                    }
                });

                const handle = Utils.create('div', {
                    className: 'transition',
                    style: {
                        position: 'absolute',
                        top: '-10px',
                        width: '20px',
                        height: '20px',
                        borderRadius: '50%',
                        background: 'black',
                        left: 'calc(50% - 10px)'
                    }
                });

                sliderTrack.appendChild(handle);
                sliderContainer.appendChild(sliderTrack);
                const rightContainer = Utils.create('div', { 
                    className: 'align-center text-s',
                    style: { 
                        height: '30px', 
                        minWidth: '120px'
                    } 
                });
                // Create logo containers with consistent sizing
                leftContainer.innerHTML = `<img src="company-logos/${axis.leftBrand}" alt="" style="height: 32px; width: auto; object-fit: contain; max-width: 100px;">`;
                rightContainer.innerHTML = `<img src="company-logos/${axis.rightBrand}" alt="" style="height: 32px; width: auto; object-fit: contain; max-width: 100px;">`;
                
                sliderRow.appendChild(leftContainer);
                sliderRow.appendChild(sliderContainer);
                sliderRow.appendChild(rightContainer);
                container.appendChild(sliderRow);
                Personality.addSliderEvents(sliderTrack, handle, index, app);

                return container;
            },

            addSliderEvents: (track, handle, index, app) => {
                let isDragging = false;

                const updateSlider = (clientX) => {
                    const rect = track.getBoundingClientRect();
                    const position = Math.max(0, Math.min(1, (clientX - rect.left) / rect.width));
                    const snappedPosition = Math.round(position * 10) / 10;
                    
                    app.sliderValues[index] = snappedPosition * 100;
                    handle.style.left = `calc(${snappedPosition * 100}% - 10px)`;
                    
                    const hue = snappedPosition === 0.5 ? 0 : snappedPosition * 240;
                    handle.style.background = snappedPosition === 0.5 ? 'black' : `hsl(${hue}, 100%, 50%)`;
                    
                    app.activeProfile = null;
                    app.updateResults();
                    Story.updateAIPromptDisplay(app);
                };

                Utils.addEvents(track, {
                    mousedown: (e) => { isDragging = true; updateSlider(e.clientX); },
                    touchstart: (e) => { isDragging = true; updateSlider(e.touches[0].clientX); }
                });

                Utils.addEvents(document, {
                    mousemove: (e) => isDragging && updateSlider(e.clientX),
                    touchmove: (e) => isDragging && updateSlider(e.touches[0].clientX),
                    mouseup: () => isDragging = false,
                    touchend: () => isDragging = false
                });
            },

            updateSliderPositions: (sliderValues) => {
                const sliders = Utils.$$('#sliders > div');
                sliders.forEach((slider, index) => {
                    const handle = slider.querySelector('div[style*="position: absolute"]');
                    const value = sliderValues[index];
                    const position = value / 100;
                    
                    handle.style.left = `calc(${value}% - 10px)`;
                    const hue = position === 0.5 ? 0 : position * 240;
                    handle.style.background = position === 0.5 ? 'black' : `hsl(${hue}, 100%, 50%)`;
                });
            }
        };

        // ========== PROFILES.JS ==========
        const Profiles = {
            calculateSimilarity: (profileValues, currentValues) => {
                const difference = currentValues.reduce((sum, value, index) => 
                    sum + Math.abs(value - (profileValues[index] || 50)), 0);
                return 1 - (difference / (100 * currentValues.length));
            },

            examples: {
                'chanel': {
                    sliderValues: [5, 20, 30, 60, 10],
                    brandStory: {
                        trend: 'fast fashion dominance',
                        geography: 'global luxury markets',
                        companyName: 'chanel',
                        category: 'luxury fashion house',
                        differentiation: 'maintains timeless elegance and exclusivity',
                        customer: 'sophisticated women',
                        needState: 'who value heritage and craftsmanship'
                    },
                    isExample: true
                },
                'h&m': {
                    sliderValues: [95, 70, 50, 40, 60],
                    brandStory: {
                        trend: 'rising sustainability concerns',
                        geography: 'global fast fashion markets',
                        companyName: 'h&m',
                        category: 'fashion retailer',
                        differentiation: 'makes trendy fashion accessible to everyone',
                        customer: 'style-conscious consumers',
                        needState: 'who want affordable, on-trend clothing'
                    },
                    isExample: true
                },
                'google': {
                    sliderValues: [50, 95, 80, 30, 95],
                    brandStory: {
                        trend: 'information overload',
                        geography: 'the global internet',
                        companyName: 'google',
                        category: 'search engine',
                        differentiation: 'organizes the world\'s information universally',
                        customer: 'curious minds everywhere',
                        needState: 'who seek instant, accurate answers'
                    },
                    isExample: true
                },
                'tesla': {
                    sliderValues: [30, 60, 95, 70, 95],
                    brandStory: {
                        trend: 'climate change awareness',
                        geography: 'global automotive markets',
                        companyName: 'tesla',
                        category: 'electric vehicle company',
                        differentiation: 'accelerates sustainable transport adoption',
                        customer: 'forward-thinking drivers',
                        needState: 'who want performance without compromise'
                    },
                    isExample: true
                },
                'apple': {
                    sliderValues: [10, 60, 90, 50, 95],
                    brandStory: {
                        trend: 'technology complexity',
                        geography: 'global consumer electronics',
                        companyName: 'apple',
                        category: 'technology company',
                        differentiation: 'makes advanced technology intuitive and beautiful',
                        customer: 'creative professionals and everyday users',
                        needState: 'who value simplicity and design excellence'
                    },
                    isExample: true
                },
                'nike': {
                    sliderValues: [40, 90, 95, 30, 85],
                    brandStory: {
                        trend: 'sedentary lifestyles',
                        geography: 'global sports markets',
                        companyName: 'nike',
                        category: 'athletic brand',
                        differentiation: 'inspires athletic achievement for everyone',
                        customer: 'athletes and fitness enthusiasts',
                        needState: 'who push their limits and strive for greatness'
                    },
                    isExample: true
                },
                'palantir': {
                    sliderValues: [10, 5, 30, 90, 40],
                    brandStory: {
                        trend: 'data complexity and security threats',
                        geography: 'global enterprise markets',
                        companyName: 'palantir',
                        category: 'data analytics platform',
                        differentiation: 'transforms complex data into actionable intelligence',
                        customer: 'government agencies and large enterprises',
                        needState: 'who need to make critical decisions from vast datasets'
                    },
                    isExample: true
                },
                'honda': {
                    sliderValues: [50, 30, 10, 50, 30],
                    brandStory: {
                        trend: 'automotive disruption',
                        geography: 'global automotive markets',
                        companyName: 'honda',
                        category: 'automotive manufacturer',
                        differentiation: 'delivers reliable, practical mobility solutions',
                        customer: 'everyday drivers and families',
                        needState: 'who value dependability and value'
                    },
                    isExample: true
                },
                'disney': {
                    sliderValues: [40, 95, 60, 5, 50],
                    brandStory: {
                        trend: 'digital entertainment proliferation',
                        geography: 'global family entertainment',
                        companyName: 'disney',
                        category: 'entertainment company',
                        differentiation: 'creates magical experiences for all ages',
                        customer: 'families and dreamers',
                        needState: 'who seek wonder, joy, and shared memories'
                    },
                    isExample: true
                },
                'ny times': {
                    sliderValues: [30, 10, 40, 95, 60],
                    brandStory: {
                        trend: 'misinformation and media fragmentation',
                        geography: 'global news landscape',
                        companyName: 'the new york times',
                        category: 'news organization',
                        differentiation: 'delivers authoritative, in-depth journalism',
                        customer: 'informed citizens and decision makers',
                        needState: 'who demand credible, comprehensive news coverage'
                    },
                    isExample: true
                },
                'booking.com': {
                    sliderValues: [60, 30, 20, 70, 10],
                    brandStory: {
                        trend: 'travel complexity and choice overload',
                        geography: 'global travel markets',
                        companyName: 'booking.com',
                        category: 'travel booking platform',
                        differentiation: 'simplifies travel planning with comprehensive options',
                        customer: 'travelers and vacation planners',
                        needState: 'who want convenience and comprehensive choice'
                    },
                    isExample: true
                },
                'airbnb': {
                    sliderValues: [70, 80, 90, 20, 95],
                    brandStory: {
                        trend: 'standardized hotel experiences',
                        geography: 'global accommodation markets',
                        companyName: 'airbnb',
                        category: 'accommodation platform',
                        differentiation: 'enables authentic, local travel experiences',
                        customer: 'adventurous travelers and hosts',
                        needState: 'who crave unique, personal connections'
                    },
                    isExample: true
                }
            },

            updateProfileButtons: (app) => {
                const container = Utils.byId('allProfileButtons');
                if (container) {
                    Profiles.populateProfileContainer(container, app);
                }
            },

            populateProfileContainer: (container, app) => {
                container.innerHTML = '';

                const savedProfiles = Utils.storage.get('savedBrandProfiles', {});
                const allProfiles = { ...Profiles.examples, ...savedProfiles };

                const profileData = Object.entries(allProfiles)
                    .map(([name, profile]) => ({
                        name,
                        profile,
                        similarity: Profiles.calculateSimilarity(profile.sliderValues || profile, app.sliderValues)
                    }))
                    .sort((a, b) => b.similarity - a.similarity);

                profileData.forEach(({ name, profile, similarity }) => {
                    const buttonComponent = Profiles.createProfileButtonComponent(name, profile, similarity, app.activeProfile, app);
                    container.appendChild(buttonComponent);
                });
            },

            createProfileButtonComponent: (name, profile, similarity, activeProfile, app) => {
                const container = Utils.create('div', { className: 'row gap-xs' });

                const button = Components.button(name, {
                    className: 'radius-s transition',
                    style: { 
                        opacity: Math.max(0.3, similarity),
                        textDecoration: activeProfile === name ? 'underline' : 'none'
                    },
                    onclick: () => Profiles.loadProfile(name, app)
                });

                container.appendChild(button);

                if (!profile.isExample) {
                    const deleteBtn = Components.button('Ã—', {
                        className: 'background-negative',
                        title: `Delete ${name}`,
                        onclick: () => Profiles.deleteProfile(name, app)
                    });
                    container.appendChild(deleteBtn);
                }

                return container;
            },

            loadProfile: (name, app) => {
                const savedProfiles = Utils.storage.get('savedBrandProfiles', {});
                const profile = Profiles.examples[name] || savedProfiles[name];
                
                if (!profile) return;

                app.activeProfile = name;
                app.sliderValues = [...profile.sliderValues];
                Personality.updateSliderPositions(app.sliderValues);

                if (profile.brandStory) {
                    Object.entries(profile.brandStory).forEach(([key, value]) => {
                        if (key !== 'companyName') {
                            const element = Utils.byId(key);
                            if (element) element.value = value || '';
                        }
                    });
                }

                app.updateResults();
                Story.updateAIPromptDisplay(app);
            },

            deleteProfile: (name, app) => {
                if (!confirm(`delete profile "${name}"?`)) return;

                const savedProfiles = Utils.storage.get('savedBrandProfiles', {});
                delete savedProfiles[name];
                
                if (app.activeProfile === name) {
                    app.activeProfile = null;
                }
                if (app.lastSavedProfile === name) {
                    app.lastSavedProfile = null;
                }
                
                if (Utils.storage.set('savedBrandProfiles', savedProfiles)) {
                    Profiles.updateProfileButtons(app);
                } else {
                    alert('failed to delete profile due to storage error.');
                }
            },




        };

        // ========== STORY.JS ==========
        const Story = {
            fields: [
                { id: 'trend', label: 'when', placeholder: 'What cultural, technological, or market trend creates the perfect timing for your brand? Examples: "the rise of remote work", "increasing health consciousness", "demand for sustainable products", etc.', color: '#8159FB', textColor: 'white' },
                { id: 'geography', label: 'where', placeholder: 'Where does your brand operate? Think about geographic markets, cultural contexts, or digital spaces. Examples: "north america", "global tech markets", "european luxury segment", etc.', color: '#02903B', textColor: 'white' },
                { id: 'category', label: 'what', placeholder: 'A phrase or sentence describing your primary business for the next five years. Examples: "Make toothpaste", "fix cars", etc.', color: '#FFBFE1', textColor: 'black' },
                { id: 'differentiation', label: 'how', placeholder: 'What\'s your secret sauce? What technology or approach sets you apart from the competition? Examples: "Made with all-natural ingredients", "best-in-class friendly service", etc.', color: '#FF4B00', textColor: 'white' },
                { id: 'customer', label: 'for whom', placeholder: 'Who is your ideal customer? Be specific about demographics, psychographics, or needs. Examples: "busy professionals", "health-conscious millennials", "small business owners", etc.', color: '#014ADD', textColor: 'white' },
                { id: 'needState', label: 'why', placeholder: 'You can think of the *why* as the reason you get out of bed in the morning and go to work. The *why* should reflect the core reason your company exists, and it won\'t change much over time.', color: '#FDC800', textColor: 'black' }
            ],

            generateBrandStory: (brandData) => {
                const defaults = {
                    trend: 'this trend',
                    geography: 'this market',
                    companyName: 'your brand',
                    category: 'a company',
                    differentiation: 'does something unique',
                    customer: 'your customers',
                    needState: 'who need this'
                };

                const data = { ...defaults, ...brandData };
                
                return `During ${data.trend}, in ${data.geography}, ${data.companyName} is ${data.category} that ${data.differentiation} for ${data.customer} ${data.needState}.`;
            },

            generateAIPrompt: (brandData, traits, suggestions, conflicts) => {
                const storyText = Story.generateBrandStory(brandData);
                const personalityTraits = traits.join(', ') || 'balanced across all dimensions';

                return `brand story: ${storyText}

personality profile: ${personalityTraits}

tone of voice: ${suggestions.toneOfVoice}

look and feel: ${suggestions.lookAndFeel}

potential conflicts: ${conflicts.join(' ')}

please help me develop this brand further by:
1. refining the brand story and messaging
2. suggesting specific tone of voice guidelines
3. recommending visual identity directions
4. identifying potential brand touchpoints and applications
5. highlighting any areas that need clarification or development

focus on making the brand authentic, memorable, and aligned with the personality profile.`;
            },

            setupBidirectionalSync: (app) => {
                const fieldMappings = [
                    { outputId: 'outputTrend', inputId: 'trend' },
                    { outputId: 'outputGeography', inputId: 'geography' },
                    { outputId: 'outputCategory', inputId: 'category' },
                    { outputId: 'outputDifferentiation', inputId: 'differentiation' },
                    { outputId: 'outputCustomer', inputId: 'customer' },
                    { outputId: 'outputNeedState', inputId: 'needState' }
                ];

                fieldMappings.forEach(({ outputId, inputId }) => {
                    const outputElement = Utils.byId(outputId);
                    const inputElement = Utils.byId(inputId);

                    if (outputElement && inputElement) {
                        Utils.addEvents(outputElement, {
                            input: () => {
                                const content = outputElement.textContent.trim();
                                inputElement.value = content;
                                app.activeProfile = null;
                                Story.updateAIPromptDisplay(app);
                            },
                            blur: () => {
                                const content = outputElement.textContent.trim();
                                inputElement.value = content;
                                if (inputElement.dispatchEvent) {
                                    inputElement.dispatchEvent(new Event('input'));
                                }
                            }
                        });
                    }
                });
            },

            setupStickyNoteHover: (app) => {
                const stickyNotes = Utils.$$('.sticky-note');
                
                stickyNotes.forEach(note => {
                    Story.setupStickyNoteColorHighlight(note, app);
                });
            },

            setupStickyNoteColorHighlight: (note, app) => {
                const noteType = note.dataset.note;
                const field = Story.getFieldConfig('label', noteType);
                
                if (!field) return;
                
                const outputId = `output${field.id.charAt(0).toUpperCase() + field.id.slice(1)}`;
                const output = Utils.byId(outputId);
                
                if (!output) return;

                const highlightElement = (element) => {
                    Story.applyFieldStyling(element, field, 'hover');
                };

                const clearHighlight = (element) => {
                    // Return to completely clean state - no styling
                    Story.clearFieldStyling(element);
                };

                Utils.addEvents(note, {
                    mouseenter: () => highlightElement(output),
                    mouseleave: () => clearHighlight(output)
                });
            },

            updateBrandStoryDisplay: (app) => {
                const currentState = app.getCurrentState();
                const brandData = currentState.brandStory;

                let companyName = 'your brand';
                if (app.activeProfile) {
                    const savedProfiles = Utils.storage.get('savedBrandProfiles', {});
                    const profile = app.exampleProfiles[app.activeProfile] || savedProfiles[app.activeProfile];
                    if (profile && profile.brandStory && profile.brandStory.companyName) {
                        companyName = profile.brandStory.companyName;
                    }
                }

                const storyPlaceholders = {
                    trend: 'this trend',
                    geography: 'this market', 
                    category: 'a company',
                    differentiation: 'does something unique',
                    customer: 'your customers',
                    needState: 'who need this'
                };

                const fieldMappings = [
                    ...Story.fields.map(field => ({
                        outputId: `output${field.id.charAt(0).toUpperCase() + field.id.slice(1)}`,
                        value: brandData[field.id],
                        placeholder: storyPlaceholders[field.id] || field.label,
                        isEmpty: !brandData[field.id],
                        field
                    })),
                    {
                        outputId: 'outputCompanyName',
                        value: companyName,
                        placeholder: 'your brand',
                        isEmpty: companyName === 'your brand',
                        field: null
                    }
                ];

                fieldMappings.forEach(mapping => Story.updateOutputField(mapping));
                Story.updateAIPromptDisplay(app);
            },

            updateAIPromptDisplay: (app) => {
                const currentState = app.getCurrentState();
                const brandData = { ...currentState.brandStory };

                if (app.activeProfile) {
                    const savedProfiles = Utils.storage.get('savedBrandProfiles', {});
                    const profile = app.exampleProfiles[app.activeProfile] || savedProfiles[app.activeProfile];
                    if (profile && profile.brandStory && profile.brandStory.companyName) {
                        brandData.companyName = profile.brandStory.companyName;
                    }
                }

                const traits = Personality.calculateTraits(app.sliderValues);
                const suggestions = Personality.generateSuggestions(traits);
                const conflicts = Personality.detectConflicts(app.sliderValues);
                const aiPrompt = Story.generateAIPrompt(brandData, traits, suggestions, conflicts);

                const displayElement = Utils.byId('aiPromptDisplay');
                if (displayElement) {
                    displayElement.textContent = aiPrompt;
                }
            },

            copyAIPrompt: () => {
                const displayElement = Utils.byId('aiPromptDisplay');
                if (!displayElement || !displayElement.textContent.trim()) {
                    alert('no ai prompt content to copy. please make sure all fields are filled.');
                    return;
                }

                const aiPrompt = displayElement.textContent;

                Story.copyToClipboard(aiPrompt);
            },

            copyToClipboard: (text) => {
                if (navigator.clipboard) {
                    navigator.clipboard.writeText(text)
                        .then(() => alert('ai prompt copied to clipboard!'))
                        .catch(() => Story.fallbackCopyToClipboard(text));
                } else {
                    Story.fallbackCopyToClipboard(text);
                }
            },

            fallbackCopyToClipboard: (text) => {
                const textarea = Utils.create('textarea', { value: text });
                document.body.appendChild(textarea);
                textarea.select();
                document.execCommand('copy');
                document.body.removeChild(textarea);
                alert('ai prompt copied to clipboard!');
            },

            getFieldConfig: (type, value) => {
                if (type === 'label') {
                    return Story.fields.find(f => f.label === value);
                }
                return null;
            },

            applyFieldStyling: (element, field, mode = 'default') => {
                if (!field || mode !== 'hover') return;

                const styles = {
                    backgroundColor: field.color + '40',
                    borderRadius: '3px',
                    padding: '2px 6px'
                };

                Utils.setStyles(element, styles);
            },

            clearFieldStyling: (element) => {
                Utils.setStyles(element, {
                    backgroundColor: '',
                    borderRadius: '',
                    padding: '',
                    opacity: '',
                    color: ''
                });
            },

            updateOutputField: ({ outputId, value, placeholder, isEmpty, field }) => {
                const element = Utils.byId(outputId);
                if (!element) return;

                const displayValue = value || placeholder;
                element.textContent = displayValue;
                element.title = isEmpty ? `Empty field: ${placeholder}` : '';
                
                const isPlaceholder = value === placeholder || isEmpty;
                
                if (field) {
                    Story.clearFieldStyling(element);
                } else {
                    if (isPlaceholder) {
                        Utils.setStyles(element, {
                            opacity: '0.5',
                            background: 'rgba(255, 182, 193, 0.2)',
                            padding: '2px 4px',
                            borderRadius: '3px'
                        });
                    } else {
                        Story.clearFieldStyling(element);
                    }
                }
            }
        };

        // ========== MAIN APPLICATION CODE ==========
        
        const Utils = {
            create: (tag, props = {}) => {
                const el = document.createElement(tag);
                Object.entries(props).forEach(([key, value]) => {
                    if (key === 'style') Object.assign(el.style, value);
                    else if (key === 'className') el.className = value;
                    else if (key.startsWith('on')) el.addEventListener(key.slice(2), value);
                    else el[key] = value;
                });
                return el;
            },

            $$: selector => Array.from(document.querySelectorAll(selector)),
            byId: id => document.getElementById(id),

            addEvents: (element, events) => {
                Object.entries(events).forEach(([event, handler]) => {
                    element.addEventListener(event, handler);
                });
            },

            setStyles: (element, styles) => Object.assign(element.style, styles),

            storage: {
                get: (key, defaultValue = null) => {
                    try { return JSON.parse(localStorage.getItem(key)) || defaultValue; }
                    catch { return defaultValue; }
                },
                set: (key, value) => {
                    try { localStorage.setItem(key, JSON.stringify(value)); return true; }
                    catch { return false; }
                }
            },

        };

        
        const Components = {
            button: (text, props = {}) => Utils.create('span', {
                textContent: text,
                className: 'padding-m border radius-s transition',
                style: { ...props.style },
                ...props
            })
        };

        function getAppTemplate() {
            return `
                <div id="brandkit-root">
                    <div class="row gap-l sticky padding-l align-center">
                        <div id="allProfileButtons" class="row gap-l"></div>
                    </div>
                    <section class="view align-center">
                        <div class="page column padding-l gap-xl">
                            <div id="stickyNotesArea" class="column gap-l align-center">
                                <div class="row gap-l">
                                    <textarea id="trend" data-note="when" data-output="outputTrend" placeholder="When? What cultural, technological, or market trend creates the perfect timing for your brand?" style="background: #8159FB; color: white; width: 333px; height: 333px; border: none; transform: rotate(-2deg); padding: 20px;"></textarea>
                                    <textarea id="geography" data-note="where" data-output="outputGeography" placeholder="Where? Where does your brand operate? Think about geographic markets, cultural contexts, or digital spaces." style="background: #02903B; color: white; width: 333px; height: 333px; border: none; transform: rotate(-1deg); padding: 20px;"></textarea>
                                    <textarea id="category" data-note="what" data-output="outputCategory" placeholder="What? A phrase or sentence describing your primary business for the next five years." style="background: #FFBFE1; color: black; width: 333px; height: 333px; border: none; transform: rotate(2deg); padding: 20px;"></textarea>
                                </div>
                                <div class="row gap-l">
                                    <textarea id="differentiation" data-note="how" data-output="outputDifferentiation" placeholder="How? What's your secret sauce? What technology or approach sets you apart from the competition?" style="background: #FF4B00; color: white; width: 333px; height: 333px; border: none; transform: rotate(1deg); padding: 20px;"></textarea>
                                    <textarea id="customer" data-note="for whom" data-output="outputCustomer" placeholder="Who? Who is your ideal customer? Be specific about demographics, psychographics, or needs?" style="background: #014ADD; color: white; width: 333px; height: 333px; border: none; transform: rotate(1deg); padding: 20px;"></textarea>
                                    <textarea id="needState" data-note="why" data-output="outputNeedState" placeholder="Why? The reason you get out of bed in the morning and go to work. The core reason your company exists." style="background: #FDC800; color: black; width: 333px; height: 333px; border: none; transform: rotate(-1deg); padding: 20px;"></textarea>
                                </div>
                            </div>
                            <div id="sliders" class="column gap-xl padding-xl border" style="transform: rotate(-1deg);"></div>
                            <h1>
                                <span>During </span><span id="outputTrend" contenteditable="true" class="transition radius-xs">this trend</span><span>, in </span><span id="outputGeography" contenteditable="true" class="transition radius-xs">this market</span><span>, </span><span id="outputCompanyName" contenteditable="true" class="transition radius-xs">your brand</span><span> is </span><span id="outputCategory" contenteditable="true" class="transition radius-xs">a company</span><span> that </span><span id="outputDifferentiation" contenteditable="true" class="transition radius-xs">does something unique</span><span> for </span><span id="outputCustomer" contenteditable="true" class="transition radius-xs">your customers</span><span> </span><span id="outputNeedState" contenteditable="true" class="transition radius-xs">who need this</span><span>.</span>
                            </h1>
                            <div class="row gap-l">
                                <div class="box">
                                    <h5>personality is <span id="traits"></span></h5>
                                </div>
                                <div class="box">
                                    <h5>tone of voice is <span id="toneOfVoice"></span></h5>
                                </div>
                                <div class="box">
                                    <h5>look and feel is <span id="lookAndFeel"></span></h5>
                                </div>
                                <div class="box">
                                    <h5>potential conflicts are <span id="conflicts"></span></h5>
                                </div>
                            </div>
                            <div class="column gap-l">
                                <div class="box padding-l" style="display: none;">
                                    <h5>AI Prompt:</h5>
                                    <pre id="aiPromptDisplay" class="text-s" style="white-space: pre-wrap; word-wrap: break-word;"></pre>
                                </div>
                                <div class="align-center">
                                    <div id="copyPrompt" class="box-l padding-l background-primary foreground-primary transition border-none align-center"><h4>âœ¨ Copy Brand Story Prompt âœ¨</h4></div>
                                </div>
                            </div>
                        </div>
                    </section>
                </div>
            `;
        }
        function renderApp() {
            document.body.innerHTML = getAppTemplate();
        }
        renderApp();


        // Application State
        class BrandApp {
            constructor() {
                this.sliderValues = new Array(5).fill(50);
                this.activeProfile = null;
                this.lastSavedProfile = null;
                this.exampleProfiles = Profiles.examples;

                this.init();
            }

            getCurrentState() {
                const brandData = {};

                Story.fields.forEach(field => {
                    const input = Utils.byId(field.id);
                    brandData[field.id] = input && input.value.trim() ? input.value.trim() : '';
                });

                return {
                    sliderValues: [...this.sliderValues],
                    brandStory: brandData,
                    activeProfile: this.activeProfile
                };
            }



            init() {
                // Auto-clear form values on every refresh
                Story.fields.forEach(field => {
                    const input = Utils.byId(field.id);
                    if (input) input.value = '';
                });
                this.sliderValues = new Array(5).fill(50);
                this.activeProfile = null;
                this.lastSavedProfile = null;
                
                // Clear localStorage data on refresh
                try {
                    localStorage.removeItem('savedBrandProfiles');
                } catch (e) {
                    console.warn('Could not clear localStorage:', e);
                }
                
                this.initializeSliders();
                this.initializeBrandStory();
                Story.setupStickyNoteHover(this);
                this.updateResults();
                Story.updateAIPromptDisplay(this);
            }





            initializeSliders() {
                const container = Utils.byId('sliders');
                Personality.axes.forEach((axis, index) => {
                    container.appendChild(Personality.createSlider(axis, index, this));
                });
            }

            initializeBrandStory() {
                const inputHandlers = [
                    { 
                        id: 'copyPrompt', 
                        events: { 
                            click: () => Story.copyAIPrompt(),
                            mouseenter: (e) => e.target.style.transform = 'scale(1.05)',
                            mouseleave: (e) => e.target.style.transform = 'scale(1)'
                        }
                    }
                ];

                Story.fields.forEach(field => {
                    inputHandlers.push({
                        id: field.id,
                        events: { input: () => Story.updateBrandStoryDisplay(this) }
                    });
                });

                inputHandlers.forEach(({ id, events }) => {
                    const element = Utils.byId(id);
                    if (element) Utils.addEvents(element, events);
                });

                Story.setupBidirectionalSync(this);
            }

            updateResults() {
                const traits = Personality.calculateTraits(this.sliderValues);
                const suggestions = Personality.generateSuggestions(traits);
                const conflicts = Personality.detectConflicts(this.sliderValues);

                const resultUpdates = [
                    { id: 'traits', content: traits.join(', ') || 'balanced' },
                    { id: 'toneOfVoice', content: suggestions.toneOfVoice },
                    { id: 'lookAndFeel', content: suggestions.lookAndFeel },
                    { id: 'conflicts', content: conflicts.join(' ') }
                ];

                resultUpdates.forEach(({ id, content }) => {
                    const element = Utils.byId(id);
                    if (element) element.textContent = content;
                });

                Profiles.updateProfileButtons(this);
                Story.updateBrandStoryDisplay(this);
                Story.updateAIPromptDisplay(this);
            }
        }

        const app = new BrandApp();
    </script>
</body>
</html>